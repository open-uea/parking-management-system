const t={BEFORE_FETCH:()=>{},AFTER_FETCH:()=>{}};function e(){return e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},e.apply(this,arguments)}const r=new class{constructor(){this._getFromJSONBin()}backend({body:r,endpoint:n}){let i=0;return t.BEFORE_FETCH(),new Promise((s,o)=>{const a=e=>this._putToJSONBin(n).then(()=>{t.AFTER_FETCH(),s(e)}),u=e=>(t.AFTER_FETCH(),o(e)),c=setInterval(()=>{if(i++,this.db){clearInterval(c);let t=[];const{pathname:i,searchParams:s}=new URL("http://localhost:3000"+n),o=s.get("table");for(const[e,r]of s)"table"!=e&&(t=[e,r]);switch(i+"?"){case"/api/v1/get_all?":a(this.db[o]);break;case"/api/v1/get?":a(this.db[o].filter(e=>e[t[0]]===t[1])[0]);break;case"/api/v1/post?":this.db[o].push(JSON.parse(r)),a(JSON.parse(r));break;case"/api/v1/put?":let n;this.db[o]=this.db[o].map(i=>i[t[0]]===t[1]?(n=e({},i,JSON.parse(r)),n):i),a(n);break;case"/api/v1/delete?":this.db[o]=this.db[o].filter(e=>e[t[0]]!==t[1]),a("{status: SUCCESSFUL}");break;case"/api/v1/auth?":a(this.db[o].filter(t=>t.password===JSON.parse(r).password&&(t.name===JSON.parse(r).name||t.email&&t.email===JSON.parse(r).email))[0]);break;case"/api/v1/recover-email?":a("{status: SUCCESSFUL}");break;default:u(`Unknown api endpoint ${i}`)}}10===i&&(clearInterval(c),u("./public/db/index.json connection timed out"))},1e3)})}_getFromJSONBin(){fetch("https://api.jsonbin.io/b/6281e66d25069545a337fa27",{method:"GET",headers:{versioning:!1,"Secret-Key":"$2b$10$7r9JOM3pywMiCEjVDCMg0.h/QybOzC3DqhplCvwT1P.bA6tv7LWgy"}}).then(t=>{if(200!==t.status)throw Error("Something went wrong with the connection");return t.json()}).then(t=>{this.db=t}).catch(t=>console.error(t))}_putToJSONBin(t){const{pathname:e}=new URL("http://localhost:3000"+t),r=e+"?";return"/api/v1/post?"===r||"/api/v1/put?"===r||"/api/v1/delete?"===r?new Promise((t,e)=>{fetch("https://api.jsonbin.io/b/6281e66d25069545a337fa27",{method:"PUT",headers:{"Content-Type":"application/json",versioning:!1,"Secret-Key":"$2b$10$7r9JOM3pywMiCEjVDCMg0.h/QybOzC3DqhplCvwT1P.bA6tv7LWgy"},body:JSON.stringify(this.db)}).then(t=>{if(200!==t.status)throw Error("Something went wrong with the connection");return t.json()}).then(({data:e})=>{this.db=e,t()}).catch(t=>e(t))}):Promise.resolve()}};var n,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(t){!function(e){var r="object"==typeof i?i:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=s(t);function s(t,e){return function(r,n){"function"!=typeof t[r]&&Object.defineProperty(t,r,{configurable:!0,writable:!0,value:n}),e&&e(r,n)}}void 0===r.Reflect?r.Reflect=t:n=s(r.Reflect,n),function(t){var e=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,a=!s&&!o,u={create:s?function(){return j(Object.create(null))}:o?function(){return j({__proto__:null})}:function(){return j({})},has:a?function(t,r){return e.call(t,r)}:function(t,e){return e in t},get:a?function(t,r){return e.call(t,r)?t[r]:void 0}:function(t,e){return t[e]}},c=Object.getPrototypeOf(Function),h="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,p=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],r=function(){function t(t,e,r){this._index=0,this._keys=t,this._values=e,this._selector=r}return t.prototype["@@iterator"]=function(){return this},t.prototype[i]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var r=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var r=this._find(t,!0);return this._values[r]=e,this},e.prototype.delete=function(e){var r=this._find(e,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new r(this._keys,this._values,n)},e.prototype.values=function(){return new r(this._keys,this._values,s)},e.prototype.entries=function(){return new r(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[i]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function n(t,e){return t}function s(t,e){return e}function o(t,e){return[t,e]}}():Map,f=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new p}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[i]=function(){return this.keys()},t}():Set,l=new(h||"function"!=typeof WeakMap?function(){var t=u.create(),r=n();return function(){function t(){this._key=n()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&u.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?u.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=n()},t}();function n(){var e;do{e="@@WeakMap@@"+o()}while(u.has(t,e));return t[e]=!0,e}function i(t,n){if(!e.call(t,r)){if(!n)return;Object.defineProperty(t,r,{value:u.create()})}return t[r]}function s(t,e){for(var r=0;r<e;++r)t[r]=255*Math.random()|0;return t}function o(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t):s(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var r="",n=0;n<16;++n){var i=e[n];4!==n&&6!==n&&8!==n||(r+="-"),i<16&&(r+="0"),r+=i.toString(16).toLowerCase()}return r}}():WeakMap);function d(t,e,r){var n=l.get(t);if(g(n)){if(!r)return;n=new p,l.set(t,n)}var i=n.get(e);if(g(i)){if(!r)return;i=new p,n.set(e,i)}return i}function y(t,e,r){if(E(t,e,r))return!0;var n=C(e);return!R(n)&&y(t,n,r)}function E(t,e,r){var n=d(e,r,!1);return!g(n)&&!!n.has(t)}function v(t,e,r){if(E(t,e,r))return _(t,e,r);var n=C(e);return R(n)?void 0:v(t,n,r)}function _(t,e,r){var n=d(e,r,!1);if(!g(n))return n.get(t)}function m(t,e,r,n){d(r,n,!0).set(t,e)}function T(t,e){var r=O(t,e),n=C(t);if(null===n)return r;var i=T(n,e);if(i.length<=0)return r;if(r.length<=0)return i;for(var s=new f,o=[],a=0,u=r;a<u.length;a++)s.has(p=u[a])||(s.add(p),o.push(p));for(var c=0,h=i;c<h.length;c++){var p;s.has(p=h[c])||(s.add(p),o.push(p))}return o}function O(t,e){var r=[],n=d(t,e,!1);if(g(n))return r;for(var s=function(t){var e=M(t,i);if(!A(e))throw new TypeError;var r=e.call(t);if(!S(r))throw new TypeError;return r}(n.keys()),o=0;;){var a=D(s);if(!a)return r.length=o,r;var u=a.value;try{r[o]=u}catch(t){try{I(s)}finally{throw t}}o++}}function w(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function g(t){return void 0===t}function R(t){return null===t}function S(t){return"object"==typeof t?null!==t:"function"==typeof t}function b(t){var e=function(t,e){switch(w(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var r=M(t,n);if(void 0!==r){var i=r.call(t,"string");if(S(i))throw new TypeError;return i}return function(t,e){var r,n,i=t.toString;if(A(i)&&!S(n=i.call(t)))return n;if(A(r=t.valueOf)&&!S(n=r.call(t)))return n;throw new TypeError}(t)}(t);return"symbol"==typeof e?e:function(t){return""+t}(e)}function P(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function A(t){return"function"==typeof t}function Y(t){return"function"==typeof t}function M(t,e){var r=t[e];if(null!=r){if(!A(r))throw new TypeError;return r}}function D(t){var e=t.next();return!e.done&&e}function I(t){var e=t.return;e&&e.call(t)}function C(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===c)return e;if(e!==c)return e;var r=t.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return e;var i=n.constructor;return"function"!=typeof i||i===t?e:i}function j(t){return t.__=void 0,delete t.__,t}t("decorate",function(t,e,r,n){if(g(r)){if(!P(t))throw new TypeError;if(!Y(e))throw new TypeError;return function(t,e){for(var r=t.length-1;r>=0;--r){var n=(0,t[r])(e);if(!g(n)&&!R(n)){if(!Y(n))throw new TypeError;e=n}}return e}(t,e)}if(!P(t))throw new TypeError;if(!S(e))throw new TypeError;if(!S(n)&&!g(n)&&!R(n))throw new TypeError;return R(n)&&(n=void 0),function(t,e,r,n){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e,r,n);if(!g(s)&&!R(s)){if(!S(s))throw new TypeError;n=s}}return n}(t,e,r=b(r),n)}),t("metadata",function(t,e){return function(r,n){if(!S(r))throw new TypeError;if(!g(n)&&!function(t){switch(w(t)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;m(t,e,r,n)}}),t("defineMetadata",function(t,e,r,n){if(!S(r))throw new TypeError;return g(n)||(n=b(n)),m(t,e,r,n)}),t("hasMetadata",function(t,e,r){if(!S(e))throw new TypeError;return g(r)||(r=b(r)),y(t,e,r)}),t("hasOwnMetadata",function(t,e,r){if(!S(e))throw new TypeError;return g(r)||(r=b(r)),E(t,e,r)}),t("getMetadata",function(t,e,r){if(!S(e))throw new TypeError;return g(r)||(r=b(r)),v(t,e,r)}),t("getOwnMetadata",function(t,e,r){if(!S(e))throw new TypeError;return g(r)||(r=b(r)),_(t,e,r)}),t("getMetadataKeys",function(t,e){if(!S(t))throw new TypeError;return g(e)||(e=b(e)),T(t,e)}),t("getOwnMetadataKeys",function(t,e){if(!S(t))throw new TypeError;return g(e)||(e=b(e)),O(t,e)}),t("deleteMetadata",function(t,e,r){if(!S(e))throw new TypeError;g(r)||(r=b(r));var n=d(e,r,!1);if(g(n))return!1;if(!n.delete(t))return!1;if(n.size>0)return!0;var i=l.get(e);return i.delete(r),i.size>0||l.delete(e),!0})}(n)}()}(n||(n={}));var s,o,a=(s=function(t,e){function r(t,e,r,n){var i,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function n(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var i,s="JsonProperties",o="JsonIgnore",a=function(t,e){return Reflect.getMetadata(d,t,e)},u=function(t,e){var r=a(t,e);return null!=r&&null!=r.name?r.name:e},c=function(t){switch(t){case f.STRING_TYPE:case f.NUMBER_TYPE:case f.BOOLEAN_TYPE:case f.DATE_TYPE:case f.STRING_TYPE_LOWERCASE:case f.NUMBER_TYPE_LOWERCASE:case f.BOOLEAN_TYPE_LOWERCASE:case f.DATE_TYPE_LOWERCASE:return!0;default:return!1}},h=function(t){return t.name||function(t){var e=t.toString(),r=e.indexOf("class"),n=e.indexOf("{",r+5);return e.substring(r+5,n).trim()}(t)},p=function(t,e){return Reflect.getMetadata("design:type",t,e)},f={OBJECT_TYPE:"Object",OBJECT_TYPE_LOWERCASE:"object",STRING_TYPE:"String",STRING_TYPE_LOWERCASE:"string",NUMBER_TYPE:"Number",NUMBER_TYPE_LOWERCASE:"number",BOOLEAN_TYPE:"Boolean",BOOLEAN_TYPE_LOWERCASE:"boolean",DATE_TYPE:"Date",DATE_TYPE_LOWERCASE:"date",ARRAY_TYPE:"Array",ARRAY_TYPE_LOWERCASE:"array",FROM_ARRAY:"fromArray"},l=function(t,e){var r=null!=t.getJsonObjectMapperCacheKey?t.getJsonObjectMapperCacheKey():h(t);return e[r]||(e[r]=new t),e[r]},d="JsonProperty";(i=e.AccessType||(e.AccessType={}))[i.READ_ONLY=0]="READ_ONLY",i[i.WRITE_ONLY=1]="WRITE_ONLY",i[i.BOTH=2]="BOTH";var y=function(t){return function(e){var r=new Function("return '"+t+"';");e.getJsonObjectMapperCacheKey=r}},E=function(t,e){this.json=e,this.message=t,this.stack=(new Error).stack},v=function(t,e,r,n,i){try{return t[e]=n[i],[]}catch(r){throw new E("Property '"+e+"' of "+t.constructor.name+" does not match datatype of "+i,n)}},_=function(t,e,r,n,i){try{return t[e]=new Date(n[i]),[]}catch(r){throw new E("Property '"+e+"' of "+t.constructor.name+" does not match datatype of "+i,n)}},m=function(t,e,r,n,i){var s=void 0!==i?n[i]||[]:n,o=s.length,a=[],u=[];if(t[e]=u,o>0)for(var p=0;p<o;p++)if(s[p]){var l=h(r);if(c(l))u.push(g[f.FROM_ARRAY](s[p],l));else{var d=new r;a.push({functionName:f.OBJECT_TYPE,instance:d,json:s[p]}),u.push(d)}}return a},T=function(t,r,n,i,u){var l,d=[];null!=r?(l=new n,t[r]=l):l=t;var y=Object.keys(l);return(y=(y=y.concat((Reflect.getMetadata(s,l)||[]).filter(function(t){return(!l.constructor.prototype.hasOwnProperty(t)||void 0!==Object.getOwnPropertyDescriptor(l.constructor.prototype,t).set)&&y.indexOf(t)<0}))).filter(function(t){return!Reflect.hasMetadata(o,l,t)})).forEach(function(t){var r=a(l,t);if(void 0===r&&(r={name:t,required:!1,access:e.AccessType.BOTH}),e.AccessType.WRITE_ONLY!=r.access){if(r.required&&void 0===i[r.name])throw new E("JSON structure does have have required property '"+r.name+"' as required by '"+h(l)+"["+t+"]",i);var n=null!=r.name?r.name:t;if(null!=i[n])if(null!=r.deserializer)l[t]=w(r.deserializer).deserialize(i[n]);else if(void 0===r.type)l[t]=i[n];else if(function(t,e){return Array===p(t,e)}(l,t))g[f.ARRAY_TYPE](l,t,r.type,i,n).forEach(function(t){d.push(t)});else{var s=null!=r.type?h(r.type):function(t,e){var r=p(t,e);return null!=r?h(r):r}(l,t);c(s)?g[s](l,t,s,i,n):(l[t]=new r.type,d.push({functionName:f.OBJECT_TYPE,type:r.type,instance:l[t],json:i[n]}))}}}),d},O={},w=function(t){return l(t,O)},g={};g[f.OBJECT_TYPE]=T,g[f.ARRAY_TYPE]=m,g[f.DATE_TYPE]=_,g[f.STRING_TYPE]=v,g[f.NUMBER_TYPE]=v,g[f.BOOLEAN_TYPE]=v,g[f.FROM_ARRAY]=function(t,e){return e===f.DATE_TYPE?new Date(t):t},g[f.OBJECT_TYPE_LOWERCASE]=T,g[f.ARRAY_TYPE_LOWERCASE]=m,g[f.DATE_TYPE_LOWERCASE]=_,g[f.STRING_TYPE_LOWERCASE]=v,g[f.NUMBER_TYPE_LOWERCASE]=v,g[f.BOOLEAN_TYPE_LOWERCASE]=v;var R=function(t,e,r){var n={},i=e.instance;return e.visited=!0,i.forEach(function(t){if(void 0!==t)if(c(typeof t))e.values.push(U[typeof t](void 0,t,j[typeof t]));else{var i={id:k(),type:f.OBJECT_TYPE,instance:t,parentIndex:r,values:[],key:void 0,visited:!1};n[i.id]=i}}),S(n)},S=function(t){var e=[];return Object.keys(t).forEach(function(r){e.push(t[r])}),e},b=function(t,e){P(t),e.values.push(t.values.pop())},P=function(t){var e,r;e=t.type===f.OBJECT_TYPE?(void 0!==(r=t.key)?'"'+r+'":':"")+"{"+t.values.join()+"}":function(t,e){return(void 0!==t?'"'+t+'":':"")+"["+e.join()+"]"}(t.key,t.values),t.values=[],t.values.push(e)},A=function(t,r,n){var i={};r.visited=!0;var h=Object.keys(r.instance);return(h=(h=h.concat((Reflect.getMetadata(s,r.instance)||[]).filter(function(t){return(!r.instance.constructor.prototype.hasOwnProperty(t)||void 0!==Object.getOwnPropertyDescriptor(r.instance.constructor.prototype,t).get)&&h.indexOf(t)<0}))).filter(function(t){return!Reflect.hasMetadata(o,r.instance,t)})).forEach(function(t){var s=r.instance[t];if(null===s)r.values.push('"'+t+'":'+s);else if(void 0!==s){var o=a(r.instance,t);if(void 0!==o&&e.AccessType.READ_ONLY===o.access);else if(void 0!==o&&void 0!==o.serializer){var h=N(o.serializer);r.values.push(U[f.STRING_TYPE](u(r.instance,t),s,h))}else if(s instanceof Array){var p={id:k(),type:f.ARRAY_TYPE,instance:s,parentIndex:n,values:[],key:u(r.instance,t),visited:!1};i[p.id]=p}else c(typeof s)?(h=j[typeof s],r.values.push(U[typeof s](u(r.instance,t),s,h))):(p={id:k(),type:f.OBJECT_TYPE,instance:s,parentIndex:n,values:[],key:u(r.instance,t),visited:!1},i[p.id]=p)}}),S(i)},Y=function(t,e,r){var n=r.serialize(e);return void 0!==t?'"'+t+'":'+n:n},M=r([y("DateSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return t.getTime()}}),D=r([y("StringSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return JSON.stringify(t)}}),I=r([y("NumberSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return t}}),C=r([y("BooleanSerializer"),n("design:paramtypes",[])],function(){this.serialize=function(t){return t}}),j={};j[f.STRING_TYPE]=new D,j[f.NUMBER_TYPE]=new I,j[f.DATE_TYPE]=new M,j[f.BOOLEAN_TYPE]=new C,j[f.STRING_TYPE_LOWERCASE]=j[f.STRING_TYPE],j[f.NUMBER_TYPE_LOWERCASE]=j[f.NUMBER_TYPE],j[f.DATE_TYPE_LOWERCASE]=j[f.DATE_TYPE],j[f.BOOLEAN_TYPE_LOWERCASE]=j[f.BOOLEAN_TYPE];var N=function(t){return l(t,j)},U=[];U[f.STRING_TYPE]=Y,U[f.NUMBER_TYPE]=Y,U[f.BOOLEAN_TYPE]=Y,U[f.DATE_TYPE]=Y,U[f.ARRAY_TYPE]=R,U[f.OBJECT_TYPE]=A,U[f.STRING_TYPE_LOWERCASE]=Y,U[f.NUMBER_TYPE_LOWERCASE]=Y,U[f.BOOLEAN_TYPE_LOWERCASE]=Y,U[f.DATE_TYPE_LOWERCASE]=Y,U[f.ARRAY_TYPE_LOWERCASE]=R,U[f.OBJECT_TYPE_LOWERCASE]=A;var k=function(){return Math.random()+"-"+Date.now()};!function(t){t.deserializeArray=function(t,r){var n=new function(){this.instances=void 0};return e(g[f.ARRAY_TYPE](n,"instances",t,r,void 0)),n.instances},t.deserialize=function(t,r){var n=new t;return e([{functionName:f.OBJECT_TYPE,instance:n,json:r}]),n};var e=function(t){var e=[];t.forEach(function(t){e.push(t)});for(var r=e[0];null!=r;)g[r.functionName](r.instance,r.instanceKey,r.type,r.json,r.jsonKey).forEach(function(t){e.push(t)}),r=e.pop()};t.serialize=function(t){var e=[],r={id:void 0,type:!0===Array.isArray(t)?f.ARRAY_TYPE:f.OBJECT_TYPE,instance:t,parentIndex:void 0,values:[],key:void 0,visited:!1};e.push(r);do{var n=e[e.length-1],i=e[e.length>1?n.parentIndex:0];if(n.visited)b(n,i),e.pop();else{var s=U[n.type](i,n,e.length-1);if(s.length>0)for(var o=s.length;--o>=0;)e.push(s[o]);else e.length>1&&b(n,i),e.pop()}}while(e.length>1);return P(r),r.values[0]}}(e.ObjectMapper||(e.ObjectMapper={})),e.JsonProperty=function(t){return function(t){return function(t,e){return Reflect.metadata(t,e)}(d,t)}("string"==typeof t?{name:t,required:!1,access:e.AccessType.BOTH}:t)},e.JsonConverstionError=E,e.CacheKey=y,e.JsonIgnore=function(){return function(t,e){Reflect.defineMetadata(o,!0,t,e)}},e.DateSerializer=M},s(o={exports:{}},o.exports),o.exports);class u{constructor(t=null){this.uid=t||Math.random().toString(16).slice(2)}deserializeArray(t){return a.ObjectMapper.deserializeArray(this.constructor,t)}deserialize(t){return a.ObjectMapper.deserialize(this.constructor,t)}serialize(t){return a.ObjectMapper.serialize(t)}parseQuery(t={}){return new URLSearchParams(e({},t))}fetch({body:t=null,endpoint:e}){return Promise.resolve(r.backend({body:t,endpoint:e}))}}class c extends u{constructor(t){super(t)}recoverEmail(){return"DRIVERS"===this.ORM?new Promise((t,e)=>{this.fetch({body:this.serialize(this),endpoint:"/api/v1/recover-email?"+this.parseQuery({table:this.ORM}),method:"POST"}).then(()=>t(!0)).catch(t=>e(t))}):Promise.reject()}auth(){return"ADMINS"===this.ORM||"DRIVERS"===this.ORM?new Promise((t,e)=>{this.fetch({body:this.serialize(this),endpoint:"/api/v1/auth?"+this.parseQuery({table:this.ORM}),method:"POST"}).then(e=>t(this.deserialize(e))).catch(t=>e(t))}):Promise.reject()}post(){return new Promise((t,e)=>{this.fetch({body:this.serialize(this),endpoint:"/api/v1/post?"+this.parseQuery({table:this.ORM}),method:"POST"}).then(e=>t(this.deserialize(e))).catch(t=>e(t))})}put(t){return new Promise((r,n)=>{this.fetch({body:this.serialize(this),endpoint:"/api/v1/put?"+this.parseQuery(e({},t,{table:this.ORM})),method:"PUT"}).then(t=>r(this.deserialize(t))).catch(t=>n(t))})}get(t){return new Promise((r,n)=>{this.fetch({endpoint:"/api/v1/get?"+this.parseQuery(e({},t,{table:this.ORM})),method:"GET"}).then(t=>r(this.deserialize(t))).catch(t=>n(t))})}delete(t){return new Promise((r,n)=>{this.fetch({endpoint:"/api/v1/delete?"+this.parseQuery(e({},t,{table:this.ORM})),method:"DELETE"}).then(()=>r(!0)).catch(t=>n(t))})}}class h extends c{constructor({name:t,password:e,uid:r}={}){super(r),this.name=t,this.password=e,this.ORM="ADMINS"}modify({name:t,password:e,state:r}={}){return this.name=t||this.name,this.state=r||this.state,this.password=e||this.password,this.put({uid:this.uid})}register(){return this.post()}login(){return new Promise((t,e)=>{this.auth().then(e=>t(e.modify({state:"online"}))).catch(t=>e(t))})}logout(){this.state="offline"}}class p extends c{constructor({name:t,email:e,password:r,uid:n}={}){super(n),this.name=t,this.email=e,this.password=r,this.state="active",this.ORM="DRIVERS"}modify({name:t,email:e,password:r,state:n}={}){return this.name=t||this.name,this.email=e||this.email,this.state=n||this.state,this.password=r||this.password,this.put({uid:this.uid})}register(){return this.post()}login(){return this.auth()}recover(){return this.recoverEmail()}toggleBan(){return"active"===this.state?this.modify({state:"banned"}):"banned"===this.state?this.modify({state:"active"}):Promise.resolve(this)}logout(){}}class f extends c{constructor({name:t,coordinate:e,capacity:r,uid:n}={}){super(n),this.name=t,this.coordinate=e,this.state="opened",this.ORM="LOTS",this.spots=this._instSpots({capacity:r})}modify({name:t,coordinate:e,state:r,spots:n}={}){return this.coordinate=e||this.coordinate,this.name=t||this.name,this.state=r||this.state,this.spots=n||this.spots,this.put({uid:this.uid})}register(){return this.post()}isTypeAvailable({type:t}){return this.spots.filter(e=>e.type===t).length}getCapacity(){return this.spots.length}getSpot({uid:t}){return this.spots.filter(e=>e.uid===t)[0]}openSpot({uid:t}){for(const e of this.spots)if(e.uid===t){e.state="opened";break}return this.modify()}reserveSpot({uid:t}){for(const e of this.spots)if(e.uid===t){e.state="reserved";break}return this.modify()}occupySpot({uid:t}){for(const e of this.spots)if(e.uid===t){e.state="occupied";break}return this.modify()}occupyRandomSpot(){for(const t of this.spots)if("opened"===t.state){t.state="occupied";break}return this.modify()}releaseRandomSpot(){for(const t of this.spots)if("occupied"===t.state){t.state="opened";break}return this.modify()}_instSpots({capacity:t}){let e=[];for(let r=0;r<t;r++)e.push({uid:Math.random().toString(16).slice(2),type:"standard",state:"opened"});return e}}class l extends c{constructor({driverUID:t,name:e,ccn:r,ccv:n,exp:i,uid:s}={}){super(s),this.driverUID=t,this.name=e,this.ccn=r,this.ccv=n,this.exp=new Date(i).toString(),this.state="active",this.ORM="PAYMENTS"}modify({name:t,ccn:e,ccv:r,exp:n}={}){return this.name=t||this.name,this.ccn=e||this.ccn,this.ccv=r||this.ccv,this.exp=n||this.exp,this.put({uid:this.uid})}register(){return this.post()}debit(){this.state="processing",this.annotation="debit"}credit(){this.state="processing",this.annotation="credit"}}class d extends c{constructor({lotUID:t,paymentUID:e,start:r,end:n,spotType:i,uid:s}={}){super(s),this.lotUID=t,this.paymentUID=e,this.state="pending",this.spotType=i||"standard",this.ORM="REQUESTS",this.start=new Date(r).toString(),this.end=new Date(n).toString()}modify({state:t}={}){return this.state=t||this.state,this.put({uid:this.uid})}send(){return this.post()}accept(){return this.modify({state:"accepted"}).then(t=>t)}reject(){return this.modify({state:"rejected"}).then(t=>t)}automate(){return new Promise((t,e)=>{(new f).get({uid:this.lotUID}).then(e=>{const r=e.isTypeAvailable({type:this.spotType});t(r?this.accept():this.reject())}).catch(()=>t(null))})}cost(){return 1667e-7*(new Date(this.end).getTime()-new Date(this.start).getTime())}checkIn(){return this.state="inuse",new Promise((t,e)=>{this.modify().then(e=>{(new f).get({uid:e.lotUID}).then(e=>t(e.occupyRandomSpot()))}).catch(t=>e(t))})}checkOut(){return this.state="expired",new Promise((t,e)=>{this.modify().then(e=>{(new f).get({uid:e.lotUID}).then(e=>t(e.releaseRandomSpot()))}).catch(t=>e(t))})}toString(){return new Promise(t=>{Promise.all([(new l).get({uid:this.paymentUID}).then(t=>(new p).get({uid:t.driverUID}).then(t=>t)),(new f).get({uid:this.lotUID}).then(t=>t)]).then(([e,r])=>{t(`${e.name.toUpperCase()} - Requested to Park at ${r.name} (${this._formatDate(new Date(this.start))} - ${this._formatDate(new Date(this.end))})`)}).catch(()=>t("Error!! request object invalid"))})}_formatDate(t){const e=t=>t.toString().padStart(2,"0");return[t.getFullYear(),e(t.getMonth()+1),e(t.getDate())].join("-")+" "+[e(t.getHours()),e(t.getMinutes())].join(":")}}class y extends c{constructor({toUserUID:t,toUserUIDS:e,fromUserUID:r,replyToRef:n,timestamp:i,title:s,content:o,uid:a}={}){super(a),this.mem=e||[t],this.toUserUID=t,this.fromUserUID=r,this.replyToRef=n,this.title=s,this.content=o,this.timestamp=i,this.ORM="MESSAGES",this.state="delivered"}modify({state:t}={}){return this.state=t||this.state,this.put({uid:this.uid})}send(){let t=[];for(let e=0;e<this.mem.length;e++)t.push(new y({toUserUID:this.mem[e],fromUserUID:this.fromUserUID,title:this.title,content:this.content,replyToRef:this.replyToRef,timestamp:this.timestamp||new Date(Date.now()).toISOString()}).post());return Promise.all(t)}toString(){return new Promise(t=>{Promise.all([(new h).get({uid:this.fromUserUID}).then(t=>t).catch(()=>null),(new p).get({uid:this.fromUserUID}).then(t=>t).catch(()=>null)]).then(([e,r])=>{t([`From: ${(e||r).name.toUpperCase()}`,`Date: ${this._formatDate(new Date(this.timestamp))}`,`Title: ${this.title}`,this.content])}).catch(()=>t([,,"Error!!"," message could not be parsed"]))})}_formatDate(t){const e=t=>t.toString().padStart(2,"0");return[t.getFullYear(),e(t.getMonth()+1),e(t.getDate())].join("-")+" "+[e(t.getHours()),e(t.getMinutes())].join(":")}}const E={ADMINS:h,DRIVERS:p,LOTS:f,MESSAGES:y,NOTIFICATIONS:class extends c{constructor({toUserUID:t,content:e,uid:r}={}){super(r),this.toUserUID=t,this.content=e,this.ORM="NOTIFICATIONS"}modify({state:t}={}){return this.state=t||this.state,this.put({uid:this.uid})}send(){return this.state="dispatched",this.post()}},REQUESTS:d,PAYMENTS:l};class v extends u{constructor(t){super(),this.ORM=t,this.constructor=E[t]}then(t){return new Promise((e,r)=>{this.fetch({endpoint:"/api/v1/get_all?"+this.parseQuery({table:this.ORM}),method:"GET"}).then(t=>this.deserializeArray(t)).then(r=>e(t(r))).catch(t=>r(t))})}}export{h as Admin,v as Collection,p as Driver,f as Lot,y as Message,t as P,l as Payment,d as Request};
//# sourceMappingURL=index.modern.js.map
